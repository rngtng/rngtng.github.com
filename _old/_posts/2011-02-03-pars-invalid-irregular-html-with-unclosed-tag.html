---
layout: post
status: publish
published: true
title: 'HowTo: parse invalid, irregular HTML having < or unlcosed tags'
author:
  display_name: tobi
  login: tobi
  email: t.bielohlawek@gmail.com
  url: http://
author_login: tobi
author_email: t.bielohlawek@gmail.com
author_url: http://
wordpress_id: 529
wordpress_url: http://www.rngtng.com/?p=529
date: '2011-02-03 13:24:48 +0000'
date_gmt: '2011-02-03 11:24:48 +0000'
categories:
- Happy Hacking
tags:
- Ruby, Rails & Co.
- parsing
- html
- irregular
- invlaid
- nokogiri
- tag
comments: []
---
<p>I had the 'problem' that user feedback included lot of love - mostly by writing 'hearts'. Unfortunately expressing hearts is done by '<3&#039; which turns the input into invalid HTML. Bummer. So if you still want allow other basic tags, you have a problem. Here&#039;s how I solved it:</p>
<p>First I checked Stackoverflow - <strong>Tian</strong> had similar problem over there: <a href="http://stackoverflow.com/questions/3268387/nokogiri-parsing-irregular">Nokogiri: Parsing Irregular <</a></p>
<p>As a quick fix I came up with this method using a reqular expression to identify unclosed tags:</p>
<p>[code]<br />
def fix_irregular_html(html)<br />
  regexp = /<([^<>]*)(<|$)/</p>
<p>  #we need to do this multiple time as regex are overlapping<br />
  while (fixed_html = html.gsub(regexp, "&amp;lt;\\1\\2")) &amp;&amp; fixed_html != html<br />
    html = fixed_html<br />
  end</p>
<p>  fixed_html<br />
end<br />
[/code]</p>
<p>See full code including test here: https://gist.github.com/796571</p>
<p>It works out well for me, I appreciate any feedback and improvements</p>
<p>See full code and test here:<br />
https://gist.github.com/796571</p>
